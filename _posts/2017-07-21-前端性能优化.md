---
layout:     post
title:      前端性能优化
subtitle:   
date:       2017-07-21
author:     Ywg
header-img: img/home-bg-o.jpg
catalog:    true
tags: 
---

## 前言
- 前端性能的一个重要指标是页面加载时间，不仅事关用户体验，也是搜索引擎排名考虑的一个因素。前端优化主要围绕提高加载速度进行。

## 页面内容
- Web 前端 80% 的响应时间花在图片、样式、脚本等资源下载上。浏览器对每个域名的连接数是有限制的，减少请求次数是缩短响应时间的关键。
#### 减少 HTTP 请求数
这条条策略是最重要最有效的，因为一个完整的请求要经过DNS寻址，与服务器建立连接，发送数据，等待服务器响应，接收数据这样一个消耗时间成本和资源成本的复杂的过程。常见方法：合并多个CSS文件和js文件，利用CSS Sprites整合图像，Inline Images(使用 data：URL scheme在实际的页面嵌入图像数据 )，合理设置HTTP缓存等。
- 合并CSS、JS等文件：可使用基于Node.js的文件合并工具
- 使用CSS Sprite精灵图：将背景图片合并成一个文件，通过background-image 和 background-position 控制显示；

#### 减少 DNS 查询

#### 避免重定向

#### 缓存 Ajax 请求

#### 懒加载（延迟加载）、 预加载

#### 减少 DOM 元素数量
- 页面中存在大量DOM元素,会导致javascript遍历DOM的效率变慢。

#### 划分内容到不同域名

#### 尽量减少 iframe 使用
- iframes 提供了一个简单的方式把一个网站的内容嵌入到另一个网站中。但其创建速度比其他包括JavaScript和CSS的DOM元素的创建慢了1-2个数量级。

####  避免 404 错误
- HTTP请求时间消耗是很大的，因此使用HTTP请求来获得一个没有用处的响应（例如404没有找到页面）是完全没有必要的，它只会降低用户体验而不会有一点好处。

## 服务器
#### CDN内容分发
把网站内容分散到多个、处于不同地域位置的服务器上可以加快下载速度。

#### 添加 Expires 或 Cache-Control 响应头

#### 启用 Gzip 压缩

#### 配置 Etag
- ETags（Entity tags，实体标签）是web服务器和浏览器用于判断浏览器缓存中的内容和服务器中的原始内容是否匹配的一种机制。

#### 提前刷新缓冲区

#### 对Ajax 请求使用 GET 方法

#### 避免图片 src 为空

## Cookie
#### 减少 Cookie 大小
Cookie 被用于身份认证、个性化设置等诸多用途。Cookie 通过 HTTP 头在服务器和浏览器间来回传送，减少 Cookie 大小可以降低其对响应速度的影响。
- 去除不必要的 Cookie；
- 尽量压缩 Cookie 大小；
- 注意设置 Cookie 的 domain 级别，如无必要，不要影响到 sub-domain；
- 设置合适的过期时间。

#### 静态资源使用无 Cookie 域名
- 静态资源一般无需使用 Cookie，可以把它们放在使用二级域名或者专门域名的无 Cookie 服务器上，降低 Cookie 传送的造成的流量浪费，提高响应速度。

## CSS
#### 把样式表放在 head 中，优先渲染
- 把样式表放在 <head> 中可以让页面渐进渲染，尽早呈现视觉反馈，给用户加载速度很快的感觉。这对内容比较多的页面尤为重要，用户可以先查看已经下载渲染的内容，而不是盯着白屏等待。如果把样式表放在页面底部，一些浏览器为减少重绘，会在 CSS 加载完成以后才渲染页面，用户只能对着白屏干瞪眼，用户体验极差。

#### 使用 <link> 替代 @import
- 对于 IE 某些版本，@import 的行为和 <link> 放在页面底部一样。所以，不要用它。

#### 不要使用 CSS 表达式
- CSS 表达式可以在 CSS 里执行 JavaScript，仅 IE5-IE7 支持，IE8 标准模式已经废弃。
- CSS 表达式超出预期的频繁执行，页面滚动、鼠标移动时都会不断执行，带来很大的性能损耗。

## JS
#### 把JS脚本放在页面底部，避免阻塞
- 浏览器下载脚本时，会阻塞其他资源并行下载，即使是来自不同域名的资源。因此，最好将脚本放在底部，以提高页面加载速度。
#### 使用外部 JS和 CSS
- 在实际应用中使用外部文件可以提高页面速度，因为JS和CSS文件都能在浏览器中产生缓存。在不同页面间重用，也能降低页面大小。

#### 压缩 CSS和JS文件
- 压缩代码可以移除非功能性的字符（注释、空格、空行等），减少文件大小，提高载入速度。

#### 移除重复脚本
- 重复的脚本不仅产生不必要的 HTTP 请求，而且重复解析执行浪费时间和计算资源。

#### 减少 DOM 操作
JavaScript 操作 DOM 很慢，尤其是 DOM 节点很多时。<br>
使用时应该注意：
- 缓存已经访问过的元素；
- 使用 DocumentFragment 暂存 DOM，整理好以后再插入 DOM 树；
- 操作 className，而不是多次读写 style；
- 避免使用 JavaScript 修复布局。

#### 使用高效的事件处理
- 减少绑定事件监听的节点，如通过事件委托；
- 尽早处理事件，在 DOMContentLoaded 即可进行，不用等到 load 以后。
- 对于 resize、scroll 等触发频率极高的事件，应该通过throttle节流机制降低处理程序执行频率。

#### JS代码注意：谨慎使用with,避免使用eval Function函数,减少作用域链查找。

## 图片篇
####  压缩图片，优化图片大小

#### 使用CSS-Sprites精灵图
- 水平排列 Sprite 中的图片，垂直排列会增加图片大小；
- Spirite 中把颜色较近的组合在一起可以降低颜色数，理想状况是低于 256 色以适用 PNG8 格式；
- 不要在 Spirite 的图像中间留有较大空隙。减少空隙虽然不太影响文件大小，但可以降低用户代理把图片解压为像素图的内存消耗，对移动设备更友好。

#### 不要在HTML中使用缩放图片
- 不要使用 <img> 的 width、height 缩放图片，如果用到小图片，就使用相应大小的图片。

#### favicon.ico要小而且可缓存
favicon.ico 一般存放在网站根目录下，无论是否在页面中设置，浏览器都会尝试请求这个文件。<br>
所以确保这个图标：
- 存在（避免 404）；
- 尽量小，最好小于 1K；
- 设置较长的过期时间。
- 对于较新的浏览器，可以使用 PNG 格式的 favicon。

#### 设置img图片的宽和高，以免浏览器按照「猜」的宽高给图片保留的区域和实际宽高差异，产生重绘。
