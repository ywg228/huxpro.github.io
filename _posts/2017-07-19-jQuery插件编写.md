---
layout:     post
title:      jQuery插件编写
subtitle:   JS深入
date:       2017-07-19
author:     Ywg
header-img: img/home-bg-o.jpg
catalog:    true
tags: JavaScript JS深入
---

## 前言
注意点：
- 使用自执行匿名函数避免作用域污染
- 插件尽量支持链式语法，可以通过 return this 实现；
- 插件尽量对外暴露尽可能少的调用入口，

## jQuery插件模板
``` 
    /**
     * jQuery插件模板
     */
    ;(function (factory) { //支持ommonJS, AMD模块化
        if (typeof define === 'function' && define.amd) {
            // AMD
            define(['jquery'], factory);
        } else if (typeof module !== 'undefined' && module.exports) {
            // CommonJS
            module.exports = factory(require('jquery'));
        } else {
            // Global
            factory(jQuery);  // 如果要兼容 Zepto，factory(jQuery||Zepto)
        }
    }(function ($) {

        'use strict';

        var pluginName = "pluginName";

        function Plugin(element, options) {
            this.element = element;
            this.$element = $(element);
            var defaults = {

            };
            this.options = $.extend({}, defaults, options);

            this._init();
        }

        Plugin.prototype = {
            _init: function () {

            },
            func1: function () {

            },

            func2: function () {

            }
        };

        //链式调用
        $.fn[pluginName] = function (options) {
            var args = Array.prototype.slice.call(arguments, 1);
            return this.each(function () {
                var $this = $(this);
                var data = $this.data('plugin_' + pluginName),
                    opts = typeof options === 'object' && options;
                if (!data) {
                    data = new Plugin(this, opts);
                    $this.data("plugin_" + pluginName, data);
                }

                if (typeof options === 'string') {
                    data[options].apply(data, args);
                }
            });

        };
        $.fn[pluginName].Constructor = Plugin;
    }));
``` 

## Tab选项卡案例
``` 
 ;(function ($) {
        
        'use strict';
        
        var Tabs = function (options) {
            options = options || {};
            var defaults = {
                nav: null, //tabs导航
                content: null, //tabs内容
                triggerType: 'click', //触发类型
                triggerClass: 'active', //当前class
                index: 0, //默认索引
                auto: 3000 //自动切换时间间隔
            };

            this.settings = $.extend({}, defaults, options);

            this.curIndex = this.settings.index;

            this.timer = null;

            this.count = this.settings.content.length;

            this.init();

            this.bindEvent();
        }

        Tabs.prototype = {
            init: function () {
                this.change();
            },

            bindEvent: function () {
                var _self = this;
                this.settings.nav.on(this.settings.triggerType, function () {
                    _self.stopPlay();
                    _self.curIndex = $(this).index();
                    _self.change();

                    $(this).on('transitionend, webkitTransitionEnd', function () {
                        _self.autoPlay();
                    })
                });

                if (typeof this.settings.auto === 'number') {
                    _self.autoPlay();
                }
            },

            autoPlay: function () {
                var _self = this;
                clearInterval(_self.timer);
                this.timer = setInterval(function () {
                    _self.curIndex++;
                    _self.change();
                }, this.settings.auto);
            },

            stopPlay: function () {
                clearInterval(this.timer);
                this.timer = null;
                this.settings.nav.off('transitionend, webkitTransitionEnd');
            },

            change: function () {
                if(this.curIndex >= this.count) {
                    this.curIndex = 0;
                }
                this.settings.nav.stop().eq(this.curIndex).addClass(this.settings.triggerClass).siblings().removeClass(this.settings.triggerClass);
                this.settings.content.stop().eq(this.curIndex).fadeIn().siblings().fadeOut();
            }
        }

        window.Tabs = Tabs;
    })(jQuery);
``` 

<p data-height="300" data-theme-id="0" data-slug-hash="VzLRrB" data-default-tab="js,result" data-user="ywg228" data-embed-version="2" data-pen-title="Tab选项卡插件" class="codepen">See the Pen <a href="https://codepen.io/ywg228/pen/VzLRrB/">Tab选项卡插件</a> by Mr.Yang (<a href="https://codepen.io/ywg228">@ywg228</a>) on <a href="https://codepen.io">CodePen</a>.</p>
<script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script>
