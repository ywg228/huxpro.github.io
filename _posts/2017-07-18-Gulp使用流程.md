---
layout:     post
title:      Gulp使用流程
subtitle:   自动化构建工具
date:       2017-07-18
author:     Ywg
header-img: img/home-bg-o.jpg
catalog:    true
tags: 
---

## 前言
gulp是前端开发过程中一种基于流的代码构建工具，是自动化项目的构建利器；它不仅能对网站资源进行优化，而且在开发过程中很多重复的任务能够使用正确的工具自动完成；使它，我们不仅可以很愉快的编写代码，而且大大提高我们的工作效率。<br>

Gulp使用的大致流程：安装nodejs -> 全局安装gulp -> 新建package.json -> 本地安装gulp -> 安装gulp插件 -> 配置gulpfile.js -> 运行gulp任务。

## 1. 安装nodejs
gulp是基于nodejs的，新版node自带npm <br>
下载地址：http://nodejs.cn/download/ 

#### 1.1 确认是否安装成功
``` 
node -v
npm -v
``` 
输出版本号则安装成功。

#### 1.2 升级npm
``` 
npm install npm -g
``` 

## 2. 全局安装gulp
```
npm install gulp -g 
```
#### 2.1 判断gulp是否安装成功
```
gulp -v
```
**出现的问题**：'gulp'不是内部或者外部命令，也不是可运行的程序或批处理文件 <br>
原因：缺少系统变量PATH或者PATH变量错误 <br>
解决：在系统变量Path中加入C:\Program Files\nodejs\node_global 

## 3. 新建package.json文件
package.json是基于**nodejs项目**必不可少的**配置文件**，它是存放在项目根目录的普通json文件。<br>
在项目根目录下，初始化文件，产生package.json
```
npm init
```
![package](http://img.blog.csdn.net/20160403162526733)

#### 3.1 检测package.json是否新建成功
打开项目文件根目录中的package.json文件，大致如下：
```
{
  "name": "test", //项目名称（必须）
  "version": "1.0.0", //项目版本（必须）
  "description": "我是描述", //项目描述（必须）
  "main": "index.js", //项目人口文件
  scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",   //项目作者信息
  "license": "ISC" //项目许可协议
}
```

## 4. 本地安装gulp
注：全局安装gulp是为了执行gulp任务，本地安装gulp则是为了调用gulp插件的功能 <br>
在项目文件根目录下:
```
npm install gulp --save-dev
```
安装完后，项目跟目录中多了node_modules文件夹，里面是你本地安装的插件

## 5. 安装gulp插件
在项目文件根目录下:
```
npm install gulp-less --save-dev 
```

## 6. 新建gulpfile.js文件 重点
gulpfile.js是**gulp**的**配置文件**，放于项目根目录中。
```
//导入工具包 require('node_modules里对应模块')
var gulp = require('gulp'), //本地安装gulp所用到的地方
    less = require('gulp-less');
 
//定义一个testLess任务（自定义任务名称）
gulp.task('testLess', function () {
    gulp.src('src/less/index.less') //该任务针对的文件
        .pipe(less()) //该任务调用的模块
        .pipe(gulp.dest('src/css')); //将会在src/css下生成index.css
});
 
gulp.task('default',['testLess', 'elseTask']); //定义默认任务 elseTask为其他任务，该示例没有定义elseTask任务
```
此时我们的目录结构是这样子的：
```
├── gulpfile.js
├── node_modules
│ └── gulp
└── package.json
```
详细gulp api介绍官网：http://www.gulpjs.com.cn/docs/api/

## 7. 运行gulp任务
在项目文件根目录下:按住shift + 右键 -> 打开powershell窗口  <br>
执行gulp 调用default中的所有任务 
```
gulp 或 gulp default
```
执行gulp 任务名称 运行该任务 
```
gulp testLess
```

## 8. webstorm运行gulp任务
右键项目根目录中的gulpfile.js 选择”Show Gulp Tasks”打开Gulp窗口，若出现”No task found”，选择右键”Reload tasks”，双击运行即可。

## 9. gulp使用
使用gulp，仅需知道4个API即可：gulp.task()、gulp.src()、gulp.dest()、gulp.watch()。

#### gulp.task(name[, deps], fn) 
定义任务  name：任务名称 deps：依赖任务名称 fn：回调函数
```
gulp.task('mytask', function() {
  // 做一些事
});
```
#### gulp.src(globs[, options]) 
执行任务处理的文件  globs：处理的文件路径(字符串或者字符串数组)  <br>
**globs匹配语法：**  <br>

匹配符 | 描述
------------ | -------------
`*` | 匹配文件路径中的0个或多个字符，但不会匹配路径分隔符，除非路径分隔符出现在末尾  
`**` | 匹配路径中的0个或多个目录及其子目录,需要单独出现，即它左右不能有其他东西了。如果出现在末尾，也能匹配文件。  
`?` | 匹配文件路径中的一个字符(不会匹配路径分隔符) 
`[...]` | 匹配方括号中出现的字符中的任意一个，当方括号中第一个字符为^或!时，则表示不匹配方括号中出现的其他字符中的任意一个  

!(pattern|pattern|pattern) ： 匹配任何与括号中给定的任一模式都不匹配的   <br>
?(pattern|pattern|pattern) ： 匹配括号中给定的任一模式0次或1次   <br>
+(pattern|pattern|pattern) ： 匹配括号中给定的任一模式至少1次  <br>
*(pattern|pattern|pattern)： 匹配括号中给定的任一模式0次或多次   <br>
@(pattern|pattern|pattern) ：匹配括号中给定的任一模式1次 
 
#### gulp.dest(path[, options]) 
处理完后文件生成路径

#### gulp.watch(glob [, opts], tasks) 或 gulp.watch(glob [, opts, cb]) 
监视文件，并且可以在文件发生改动时候做一些事情。它总会返回一个 EventEmitter 来发射（emit） 

## 10. 常用gulp插件
```
sass的编译（gulp-sass）
less编译 （gulp-less）
重命名（gulp-rename）
图片转换为base64-encoded （gulp-img64）
自动添加css前缀（gulp-autoprefixer）
压缩css（gulp-clean-css）
js代码校验（gulp-jshint）
合并js文件（gulp-concat）
压缩js代码（gulp-uglify）
压缩图片（gulp-imagemin）
自动刷新页面（gulp-livereload，谷歌浏览器亲测，谷歌浏览器需安装livereload插件）
图片缓存，只有图片替换了才压缩（gulp-cache）
更改提醒（gulp-notify）
阻止 gulp 插件发生错误导致进程退出并输出错误日志(gulp-plumber)
```
